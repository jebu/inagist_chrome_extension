<!DOCTYPE html>
<html>
<head>
  <script type="text/javascript" src="lib/3rdparty/jquery.js"></script>
  <script type="text/javascript" src="lib/3rdparty/jquery.tipsy.js"></script>
  <script type="text/javascript" src="lib/3rdparty/twitterlib.min.js"></script>
  <script type="text/javascript" src="lib/utils.js"></script>

  <link  rel="stylesheet" type="text/css" href="css/desktopTweets.css" />

  <base target="_blank">

  <script type="text/javascript">
  var notificationQueue = chrome.extension.getBackgroundPage().notificationQueue;
  var Options = chrome.extension.getBackgroundPage().Options;
  
  function renderTweet(tweet, container) {
    var screenName = tweet.user.screen_name;
    var userImage = tweet.user.profile_image_url;
    var tweetText = twitterlib.ify.clean(tweet.text);
    var createdAt = tweet.created_at;
    var tweetId = tweet.id;
    var footerContext = "";
    if (tweet.corelation)
      footerContext = tweet.corelation;

    var tweet = jQuery("<div></div>").addClass("tweet");
    var image = jQuery("<img src='" + userImage +"' />");
    var name = jQuery("<span><a href='http://twitter.com/" + screenName + 
                      "'>" + screenName +"</a></span>").addClass("name");
    var text = jQuery("<span>" + tweetText +"</span>").addClass("text");
    var footer = jQuery("<span><a href='http://twitter.com/" + screenName + "/status/" + 
                        tweetId + "'>" + createdAt +"</a></span>").addClass("timestamp");
    var contenxtSpan = jQuery("<span class='tweetcontext'>" + footerContext + "</span>");
    tweet.append(image).append(name).append("<br/>").append(text).
          append("<div style='clear: both;'></div>").append(footer).
          append(contenxtSpan);
    container.append(tweet);
  }

  function renderUrl(url, container) {
    var link = url.url;
    var title = url.title?url.title:link;
    var description = twitterlib.ify.clean(url.description?url.description:link);
    var uimage = url.attributes.image_src?url.attributes.image_src:"/img/inagist19.png";
    var tweet = jQuery("<div></div>").addClass("tweet");
    var image = jQuery("<img src='" + uimage +"' />");
    var name = jQuery("<span><a href='" + link + "'>" + title +"</a></span>").addClass("name");
    var text = jQuery("<span>" + description +"</span>").addClass("text");
    tweet.append(image).append(name).append("<br/>").append(text).append("<div style='clear: both;'></div>");
    container.append(tweet);
  }

  function renderTrendAlert(notification, container) {
    var channel = notification.channel;
    var cText = notification.phrase;
    var tweet = jQuery("<div></div>").addClass("tweet");
    var image = jQuery("<img src='icon.gif' />");
    var name = jQuery("<span> Trending in " + channel +"</span>").addClass("name");
    var text = jQuery("<span><a href='http://inagist.com/" + channel + "/trends?t=" + cText +
                      "'>" + cText +"</a></span>").addClass("text");
    tweet.append(image).append(name).append("<br/>").append(text).append("<div style='clear: both;'></div>");
    container.append(tweet);
  }

  $(function() {
    var notification = notificationQueue.pop();
    if (notification) {
      if (notification.trending_personal_phrase) {
        notification.trending_personal_phrase.channel=Options.get("userid");
        renderTrendAlert(notification.trending_personal_phrase, $(document.body));
      } else if (notification.trending_channel_phrase) {
        renderTrendAlert(notification.trending_channel_phrase, $(document.body));
      } else if (notification.lookedup_url) {
        renderUrl(notification.lookedup_url, $(document.body));
      } else if (notification.lookedup_tweet) {
        renderTweet(notification.lookedup_tweet, $(document.body));
      }
    }
  });
  </script>
</head>
<body>
   <script>
     var _gaq = _gaq || [];
     _gaq.push(['_setAccount', 'UA-16053252-4']);
     _gaq.push(['_trackPageview']);

     (function() {
       var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
       ga.src = 'https://ssl.google-analytics.com/ga.js';
       var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
     })();
   </script>
</body>
</html>
