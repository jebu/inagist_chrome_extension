<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <script type="text/javascript" src="lib/3rdparty/jquery.js"></script>
  <script type="text/javascript" src="lib/3rdparty/jquery.tipsy.js"></script>
  <script type="text/javascript" src="lib/3rdparty/twitterlib.min.js"></script>
  <script type="text/javascript" src="lib/3rdparty/pretty.js"></script>
  <script type="text/javascript" src="lib/utils.js"></script>

  <link  rel="stylesheet" type="text/css" href="css/desktopTweets.css" />

  <base target="_blank">

  <script type="text/javascript">
  var notificationQueue = chrome.extension.getBackgroundPage().notificationQueue;
  var Options = chrome.extension.getBackgroundPage().Options;
  
  function renderTweet(tweet, container) {
    var screenName = tweet.user.screen_name;
    var userImage = tweet.user.profile_image_url;
    var tweetText = twitterlib.ify.clean(tweet.text);
    var createdAt = tweet.created_at;
    var tweetId = tweet.id_str;
    var footerContext = "";
    if (tweet.corelation)
      footerContext = tweet.corelation;
    if (tweet.retweets)
      footerContext += " ♻" + tweet.retweets;
    if (tweet.mentions)
      footerContext += ", ↶" + tweet.mentions;

    var tweet = jQuery("<div></div>").addClass("tweet");
    var image = jQuery("<img src='" + userImage +"' />");
    var name = jQuery("<span><a href='http://twitter.com/" + screenName + 
                      "'>" + screenName +"</a></span>").addClass("name");
    var text = jQuery("<span>" + tweetText +"</span>").addClass("text");
    var footer = jQuery("<span><a href='http://twitter.com/" + screenName + "/status/" + 
                        tweetId + "'>" + prettyDate(createdAt) +"</a></span>").addClass("timestamp");
    var contenxtSpan = jQuery("<span class='tweetcontext'>" + footerContext + "</span>");
    tweet.append(image).append(name).append("<br/>").append(text).
          append("<div style='clear: both;'></div>").append(footer).
          append(contenxtSpan);
    container.append(tweet);
  }

  $(function() {
    var notification = notificationQueue.pop();
    if (notification.id) {
      renderTweet(notification, $(document.body));
    }
  });
  </script>
</head>
<body>
   <script>
     var _gaq = _gaq || [];
     _gaq.push(['_setAccount', 'UA-16053252-4']);
     _gaq.push(['_trackPageview']);

     (function() {
       var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
       ga.src = 'https://ssl.google-analytics.com/ga.js';
       var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
     })();
   </script>
</body>
</html>
